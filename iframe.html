
<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Learn how to use the Firebase platform on the Web">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Easy Chat</title>

  <!-- Disable tap highlight on IE -->
  <meta name="msapplication-tap-highlight" content="no">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Easy Chat">
  <meta name="theme-color" content="#ff9800">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Easy Chat">
  <meta name="apple-mobile-web-app-status-bar-style" content="#ff9800">

  <!-- Material Design Lite -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.grey-indigo.min.css">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.min.js"></script>

  <!-- App Styling -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=ja">
  <link rel="stylesheet" href="styles/main.css">
</head>

<script>
  (function () {
    const DELAY_MS = 60000; // 1分

    // Firebase Auth 準備完了を待つ
    function waitForAuthReady() {
      return new Promise((resolve) => {
        function attach() {
          const auth = firebase.auth();
          const unsub = auth.onAuthStateChanged(() => { unsub && unsub(); resolve(); });
        }
        if (window.firebase && firebase.auth) attach();
        else {
          const iv = setInterval(() => {
            if (window.firebase && firebase.auth) { clearInterval(iv); attach(); }
          }, 50);
        }
      });
    }

    window.addEventListener('load', async () => {
      await waitForAuthReady();
      setTimeout(async () => {
        try {
          await firebase.auth().signOut();
        } catch (e) {
          console.error('[auto] signOut error', e);
        }
      }, DELAY_MS);
    });
  })();
</script>

<body>
  <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">

    <!-- Header -->
<header class="mdl-layout__header mdl-color-text--white mdl-color--light-red-700">
  <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
    <div class="mdl-layout__header-row mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">

      <!-- ←★ ここにユーザーコンテナを先頭配置（左上） -->
      <div id="user-container" class="mdl-layout__header-row">
        <!-- サインアウト（ログイン時のみ表示） -->
        <button hidden id="sign-out"
                class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white"
                title="サインアウト">
          <i class="material-icons" style="vertical-align:middle;margin-right:4px;">logout</i> Sign-out
        </button>

        <!-- サインイン（未ログイン時のみ表示） -->
        <button hidden id="sign-in"
                class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white"
                title="ログインへ">
          <i class="material-icons" style="vertical-align:middle;margin-right:4px;">account_circle</i> Sign-in
        </button>
      </div>
    </div>
  </div>
</header>
    <!-- Main -->
    <main class="mdl-layout__content mdl-color--grey-100">
      <div id="messages-card-container" class="mdl-cell mdl-cell--12-col mdl-grid">

        <!-- Messages -->
        <div id="messages-card"
             class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
          <div id="messages-box" class="mdl-card__supporting-text mdl-color-text--grey-600">
            <div id="messages">
              <span id="message-filler"></span>
            </div>

            <!-- 送信フォーム -->
            <form id="message-form" action="#">
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input class="mdl-textfield__input" type="text" id="message" autocomplete="off">
                <label class="mdl-textfield__label" for="message">Message...</label>
              </div>
              <button id="submit" disabled type="submit"
                      class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Send
              </button>
            </form>
          </div>
        </div>

        <!-- Snackbar -->
        <div id="must-signin-snackbar" class="mdl-js-snackbar mdl-snackbar">
          <div class="mdl-snackbar__text"></div>
          <button class="mdl-snackbar__action" type="button"></button>
        </div>

      </div>
    </main>
  </div>

  <!-- Firebase SDK（Hosting の自動ロード v7系） -->
  <script src="/__/firebase/7.23.0/firebase-app.js"></script>
  <script src="/__/firebase/7.23.0/firebase-auth.js"></script>
  <script src="/__/firebase/7.23.0/firebase-firestore.js"></script>
  <script src="/__/firebase/init.js"></script>

  <!-- アプリ本体 -->
  <script src="scripts/main.js"></script>

  <!-- 追加：ヘッダーの「Sign-in」ボタンで login.html へ遷移させる（保険） -->
  <script>
    // main.js 側でもクリック時に login.html へ飛ばす実装を入れていますが、
    // HTML 側だけでも動くように保険で仕込んでおきます（重複しても支障なし）
    document.addEventListener('DOMContentLoaded', function () {
      var signInBtn = document.getElementById('sign-in');
      if (signInBtn) {
        signInBtn.addEventListener('click', function () {
          window.location.href = './login.html';
        });
      }
    });
  </script>
</body>
</html>
